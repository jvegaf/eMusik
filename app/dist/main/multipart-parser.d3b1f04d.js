"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("node:fs");require("node:path");const N=require("./main.5c9c1110.js");require("electron");require("events");require("crypto");require("fs");require("stream");require("url");require("string_decoder");require("constants");require("util");require("assert");require("path");require("os");require("child_process");require("zlib");require("http");require("https");require("querystring");require("buffer");require("node:http");require("node:https");require("node:zlib");require("node:stream");require("node:buffer");require("node:util");require("node:url");require("node:net");let h=0;const t={START_BOUNDARY:h++,HEADER_FIELD_START:h++,HEADER_FIELD:h++,HEADER_VALUE_START:h++,HEADER_VALUE:h++,HEADER_VALUE_ALMOST_DONE:h++,HEADERS_ALMOST_DONE:h++,PART_DATA_START:h++,PART_DATA:h++,END:h++};let F=1;const T={PART_BOUNDARY:F,LAST_BOUNDARY:F*=2},g=10,y=13,k=32,P=45,U=58,w=97,B=122,V=R=>R|32,_=()=>{};class Y{constructor(a){this.index=0,this.flags=0,this.onHeaderEnd=_,this.onHeaderField=_,this.onHeadersEnd=_,this.onHeaderValue=_,this.onPartBegin=_,this.onPartData=_,this.onPartEnd=_,this.boundaryChars={},a=`\r
--`+a;const r=new Uint8Array(a.length);for(let n=0;n<a.length;n++)r[n]=a.charCodeAt(n),this.boundaryChars[r[n]]=!0;this.boundary=r,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=t.START_BOUNDARY}write(a){let r=0;const n=a.length;let A=this.index,{lookbehind:d,boundary:c,boundaryChars:b,index:e,state:o,flags:l}=this;const H=this.boundary.length,m=H-1,q=a.length;let i,L;const E=u=>{this[u+"Mark"]=r},s=u=>{delete this[u+"Mark"]},f=(u,S,D,O)=>{(S===void 0||S!==D)&&this[u](O&&O.subarray(S,D))},p=(u,S)=>{const D=u+"Mark";D in this&&(S?(f(u,this[D],r,a),delete this[D]):(f(u,this[D],a.length,a),this[D]=0))};for(r=0;r<n;r++)switch(i=a[r],o){case t.START_BOUNDARY:if(e===c.length-2){if(i===P)l|=T.LAST_BOUNDARY;else if(i!==y)return;e++;break}else if(e-1===c.length-2){if(l&T.LAST_BOUNDARY&&i===P)o=t.END,l=0;else if(!(l&T.LAST_BOUNDARY)&&i===g)e=0,f("onPartBegin"),o=t.HEADER_FIELD_START;else return;break}i!==c[e+2]&&(e=-2),i===c[e+2]&&e++;break;case t.HEADER_FIELD_START:o=t.HEADER_FIELD,E("onHeaderField"),e=0;case t.HEADER_FIELD:if(i===y){s("onHeaderField"),o=t.HEADERS_ALMOST_DONE;break}if(e++,i===P)break;if(i===U){if(e===1)return;p("onHeaderField",!0),o=t.HEADER_VALUE_START;break}if(L=V(i),L<w||L>B)return;break;case t.HEADER_VALUE_START:if(i===k)break;E("onHeaderValue"),o=t.HEADER_VALUE;case t.HEADER_VALUE:i===y&&(p("onHeaderValue",!0),f("onHeaderEnd"),o=t.HEADER_VALUE_ALMOST_DONE);break;case t.HEADER_VALUE_ALMOST_DONE:if(i!==g)return;o=t.HEADER_FIELD_START;break;case t.HEADERS_ALMOST_DONE:if(i!==g)return;f("onHeadersEnd"),o=t.PART_DATA_START;break;case t.PART_DATA_START:o=t.PART_DATA,E("onPartData");case t.PART_DATA:if(A=e,e===0){for(r+=m;r<q&&!(a[r]in b);)r+=H;r-=m,i=a[r]}if(e<c.length)c[e]===i?(e===0&&p("onPartData",!0),e++):e=0;else if(e===c.length)e++,i===y?l|=T.PART_BOUNDARY:i===P?l|=T.LAST_BOUNDARY:e=0;else if(e-1===c.length)if(l&T.PART_BOUNDARY){if(e=0,i===g){l&=~T.PART_BOUNDARY,f("onPartEnd"),f("onPartBegin"),o=t.HEADER_FIELD_START;break}}else l&T.LAST_BOUNDARY&&i===P?(f("onPartEnd"),o=t.END,l=0):e=0;if(e>0)d[e-1]=i;else if(A>0){const u=new Uint8Array(d.buffer,d.byteOffset,d.byteLength);f("onPartData",0,A,u),A=0,E("onPartData"),r--}break;case t.END:break;default:throw new Error(`Unexpected state entered: ${o}`)}p("onHeaderField"),p("onHeaderValue"),p("onPartData"),this.index=e,this.state=o,this.flags=l}end(){if(this.state===t.HEADER_FIELD_START&&this.index===0||this.state===t.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==t.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}function x(R){const a=R.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!a)return;const r=a[2]||a[3]||"";let n=r.slice(r.lastIndexOf("\\")+1);return n=n.replace(/%22/g,'"'),n=n.replace(/&#(\d{4});/g,(A,d)=>String.fromCharCode(d)),n}async function C(R,a){if(!/multipart/i.test(a))throw new TypeError("Failed to fetch");const r=a.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");const n=new Y(r[1]||r[2]);let A,d,c,b,e,o;const l=[],H=new N.FormData,m=s=>{c+=E.decode(s,{stream:!0})},q=s=>{l.push(s)},i=()=>{const s=new N.File(l,o,{type:e});H.append(b,s)},L=()=>{H.append(b,c)},E=new TextDecoder("utf-8");E.decode(),n.onPartBegin=function(){n.onPartData=m,n.onPartEnd=L,A="",d="",c="",b="",e="",o=null,l.length=0},n.onHeaderField=function(s){A+=E.decode(s,{stream:!0})},n.onHeaderValue=function(s){d+=E.decode(s,{stream:!0})},n.onHeaderEnd=function(){if(d+=E.decode(),A=A.toLowerCase(),A==="content-disposition"){const s=d.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);s&&(b=s[2]||s[3]||""),o=x(d),o&&(n.onPartData=q,n.onPartEnd=i)}else A==="content-type"&&(e=d);d="",A=""};for await(const s of R)n.write(s);return n.end(),H}exports.toFormData=C;
